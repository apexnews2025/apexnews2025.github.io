<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Đăng nhập Hệ thống Thi cử</title>
    <!-- THÊM LINK CSS CỦA BOOTSTRAP Ở ĐÂY -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
    <link rel="stylesheet" href="styles.css">
        <style>
        body {
            background: url("https://colorlib.com/etc/lf/Login_v16/images/bg-01.jpg") no-repeat center center fixed;
  -webkit-background-size: cover;
  -moz-background-size: cover;
  -o-background-size: cover;
  background-size: cover;
        }
    </style>
    <script language="JavaScript">
    window.onload = function() {
        document.addEventListener("contextmenu", function(e) {
            e.preventDefault();
        }, false);
        document.addEventListener("keydown", function(e) {
            //document.onkeydown = function(e) {
            // "I" key
            if (e.ctrlKey && e.shiftKey && e.keyCode == 73) {
                disabledEvent(e);
            }
            // "J" key
            if (e.ctrlKey && e.shiftKey && e.keyCode == 74) {
                disabledEvent(e);
            }
            // "S" key + macOS
            if (e.keyCode == 83 && (navigator.platform.match("Mac") ? e.metaKey : e.ctrlKey)) {
                disabledEvent(e);
            }
            // "U" key
            if (e.ctrlKey && e.keyCode == 85) {
                disabledEvent(e);
            }
            // "F12" key
            if (event.keyCode == 123) {
                disabledEvent(e);
            }
        }, false);
 
        function disabledEvent(e) {
            if (e.stopPropagation) {
                e.stopPropagation();
            } else if (window.event) {
                window.event.cancelBubble = true;
            }
            e.preventDefault();
            return false;
        }
    };
</script>
</head>
<body>
    <nav class="navbar navbar-expand sticky-top bg-body-tertiary">
        <div class="container-fluid">
            <a class="navbar-brand" href="../index.html">VieConnect</a>
            
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="../index.html">Trang chủ</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/tin-tuc-su-kien">Tin tức & Sự kiện</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="../tra-cuu-thi-sinh">Tra cứu thí sinh</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="../ve-chung-toi">Về chúng tôi</a>
                    </li>
                    <li class="nav-item" id="examRoomNavItem">
                        <a class="nav-link active" aria-current="page" href="../dashboard.html">Phòng thi</a>
                    </li>
                </ul>
                <span class="navbar-text me-3" id="welcomeMessage">
                </span>
                <a href="../dashboard.html" class="btn btn-outline-primary">Bảng điều khiển</a>
            </div>
        </div>
    </nav>
        <div class="container mt-5">
        <div class="row justify-content-center">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        Vui lòng đăng nhập trước khi có thể truy cập vào Phòng thi và Bảng điều khiển
                    </div>
                    <div class="card-body">
                        <form id="loginForm">
                            <div class="mb-3">
                                <label for="username" class="form-label">Tên đăng nhập</label>
                                <input type="text" class="form-control" id="username" required>
                            </div>
                            <div class="mb-3">
                                <label for="password" class="form-label">Mật khẩu</label>
                                <input type="password" class="form-control" id="password" required>
                            </div>
                            <div id="errorMessage" class="text-danger mt-3" style="display: none;"></div><br>
                            <button type="submit" class="btn btn-primary">Đăng nhập</button>
                            <div style="float:right ;" class="text mt-2">Powered by VieConnect Technology</div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
     <div class="container mt-5">
     <!-- <div class="row justify-content-center">
        <div class="col-md-6 text-center">
          <div class="card shadow-lg">
            <div class="card-body">
              
              <div id="userInfo" style="display: none">
                <img
                  id="profilePicture"
                  class="rounded-circle mb-3"
                  alt="Ảnh đại diện"
                  width="100"
                  height="100"
                />
                <h4 id="userName" class="card-title"></h4>
                <div id="userGender" class="card-text"></div>
                <p id="userEmail" class="card-text"></p>

                <button onclick="logoutFacebook()" class="btn btn-danger me-2">
                  Đăng xuất Facebook
                </button>
              </div>

              
              <div id="loginArea">
                <h5 class="card-title mb-3">
                  Chọn một phương thức đăng nhập của bạn:
                </h5>

                
                <button
                  onclick="loginFacebook()"
                  class="btn btn-primary mb-3"
                  style="width: 100%"
                >
                  Đăng nhập bằng Facebook
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div> -->

    <script>
      // =======================================================
      // --- CẤU HÌNH API KEYS ---
      // =======================================================
      const FB_APP_ID = '1636288601117680';
      const GOOGLE_CLIENT_ID =
        '95738658476-cvp9qng2gb8dppfr98ie33crl4sfhcb9.apps.googleusercontent.com';

      let currentLoginMethod = null;

      // Hàm tiện ích ẩn/hiện UI
      function updateUI(isLoggedIn, userData = {}) {
        if (isLoggedIn) {
          document.getElementById('loginArea').style.display = 'none';
          document.getElementById('userInfo').style.display = 'block';
          document.getElementById('userName').innerText =
            'Xin chào, ' + userData.name;
          document.getElementById('userEmail').innerText =
            'Email: ' + (userData.email || 'Không có email');
          document.getElementById('profilePicture').src = userData.pictureUrl;
        document.getElementById('userGender').innerText =
            'Giới tính: ' + userData.gender;

        } else {
          document.getElementById('loginArea').style.display = 'block';
          document.getElementById('userInfo').style.display = 'none';
          document.getElementById('userName').innerText = '';
          document.getElementById('userEmail').innerText = '';
          document.getElementById('profilePicture').src = '';
        }
      }

      // =======================================================
      // --- LOGIC FACEBOOK (Đã điều chỉnh tên hàm) ---
      // =======================================================

      window.fbAsyncInit = function () {
        FB.init({
          appId: FB_APP_ID,
          cookie: true,
          xfbml: true,
          version: 'v24.0', // Sử dụng v20.0 thay vì v24.0 vì v24.0 chưa tồn tại
        });

        FB.getLoginStatus(function (response) {
          if (response.status === 'connected') {
            currentLoginMethod = 'facebook';
            fetchFacebookUserData();
          } else {
            // Nếu không đăng nhập Facebook, giao diện đăng nhập vẫn hiển thị
            updateUI(false);
          }
        });
      };

      function loginFacebook() {
        FB.login(
          function (response) {
            if (response.status === 'connected') {
              currentLoginMethod = 'facebook';
              fetchFacebookUserData();
            }
          },
          { scope: 'public_profile,email,user_gender' }
        );
      }

      function fetchFacebookUserData() {
        FB.api(
          '/me?fields=name,email,gender,picture.width(100).height(100)',
          function (response) {
            if (response && !response.error) {
              const userData = {
                name: response.name,
                email: response.email,
                gender: response.gender,
                pictureUrl: response.picture.data.url,
              };
              updateUI(true, userData);
            }
          }
        );
      }

      function logoutFacebook() {
        FB.logout(function (response) {
          currentLoginMethod = null;
          updateUI(false);
        });
      }

      // // =======================================================
      // // --- LOGIC GOOGLE (Thêm mới) ---
      // // =======================================================

      // // Hàm callback được gọi bởi Google SDK khi đăng nhập thành công
      // function handleGoogleLogin(response) {
      //   const profile = parseJwt(response.credential);

      //   currentLoginMethod = 'google';

      //   const userData = {
      //     name: profile.name,
      //     email: profile.email,
      //     pictureUrl: profile.picture,
      //   };

      //   updateUI(true, userData);
      // }

      // function logoutGoogle() {
      //   // Về cơ bản, chúng ta chỉ cần cập nhật lại UI
      //   currentLoginMethod = null;
      //   updateUI(false);
      //   // Google One Tap sẽ tự động xử lý trạng thái đăng xuất phía client.
      // }

      // // Hàm trợ giúp giải mã JWT (tạm thời cho mục đích hiển thị thông tin front-end)
      // function parseJwt(token) {
      //   var base64Url = token.split('.')[1];
      //   var base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
      //   var jsonPayload = decodeURIComponent(
      //     window
      //       .atob(base64)
      //       .split('')
      //       .map(function (c) {
      //         return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
      //       })
      //       .join('')
      //   );

      //   return JSON.parse(jsonPayload);
      // }
    </script>

    <!-- Nhúng Bootstrap JS (Tùy chọn) -->
    <script
      src="https://cdn.jsdelivr.net"
      integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB"
      crossorigin="anonymous"
    ></script>
    <!-- Nhúng Facebook SDK -->
    <script
      async
      defer
      crossorigin="anonymous"
      src="https://connect.facebook.net/en_US/sdk.js"
    ></script>
    <script src="auth.js"></script>
</body>
</html>
